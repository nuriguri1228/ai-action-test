# ì›Œí¬í”Œë¡œìš° ì˜ˆì œ 3: ë¬¸ì„œ ìë™ ì—…ë°ì´íŠ¸
#
# ì´ íŒŒì¼ì„ .github/workflows/ ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”:
# cp workflow-example-3-auto-docs.yml .github/workflows/auto-docs.yml
#
# ëª©ì : main ë¸Œëœì¹˜ ë³‘í•© ì‹œ ë¬¸ì„œ ìë™ ì—…ë°ì´íŠ¸
# íš¨ê³¼:
# - ğŸ“ í•­ìƒ ìµœì‹  ë¬¸ì„œ ìœ ì§€
# - ğŸ”„ ìë™ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ ë°˜ì˜
# - ğŸ‘¥ ê°œë°œìëŠ” ì½”ë“œì—ë§Œ ì§‘ì¤‘

name: Auto Documentation Update

on:
  push:
    branches: [main]
    paths:
      - 'src/**'
      - 'lib/**'
      - 'api/**'
      - 'package.json'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  check-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2  # ìµœê·¼ 2ê°œ ì»¤ë°‹ì„ ê°€ì ¸ì™€ì„œ ë³€ê²½ì‚¬í•­ í™•ì¸

      - name: Check if documentation update needed
        id: check
        run: |
          # ì½”ë“œ íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
          if git diff --name-only HEAD^ HEAD | grep -qE '\.(js|ts|jsx|tsx|py|go|java)$'; then
            echo "needs_update=true" >> $GITHUB_OUTPUT
          else
            echo "needs_update=false" >> $GITHUB_OUTPUT
          fi

      - name: Create documentation update issue
        if: steps.check.outputs.needs_update == 'true'
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # ìµœê·¼ ì»¤ë°‹ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          COMMIT_MESSAGE=$(git log -1 --pretty=format:"%s")
          COMMIT_SHA=$(git log -1 --pretty=format:"%h")
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD | grep -E '\.(js|ts|jsx|tsx|py|go|java)$' | head -10)

          gh issue create \
            --title "ğŸ“ ë¬¸ì„œ ì—…ë°ì´íŠ¸: $COMMIT_MESSAGE" \
            --label "documentation,ai-task" \
            --body "@claude ìµœê·¼ ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜í•˜ì—¬ ë¬¸ì„œë¥¼ ì—…ë°ì´íŠ¸í•´ì£¼ì„¸ìš”.

          ## ìµœê·¼ ë³€ê²½ì‚¬í•­
          - ì»¤ë°‹: $COMMIT_SHA
          - ë©”ì‹œì§€: $COMMIT_MESSAGE

          ## ë³€ê²½ëœ íŒŒì¼ë“¤
          \`\`\`
          $CHANGED_FILES
          \`\`\`

          ## ìš”ì²­ ì‚¬í•­
          1. ğŸ“– README.md ì—…ë°ì´íŠ¸ (í•„ìš”í•œ ê²½ìš°)
          2. ğŸ“š API ë¬¸ì„œ ì—…ë°ì´íŠ¸
          3. ğŸ’¡ ì‚¬ìš© ì˜ˆì œ ì¶”ê°€ ë˜ëŠ” ì—…ë°ì´íŠ¸
          4. ğŸ“‹ CHANGELOG.mdì— ë³€ê²½ì‚¬í•­ ê¸°ë¡

          ë¬¸ì„œë¥¼ ì—…ë°ì´íŠ¸í•œ í›„ PRì„ ìƒì„±í•´ì£¼ì„¸ìš”." \
            --repo ${{ github.repository }}
