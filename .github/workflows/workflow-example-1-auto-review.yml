# ì›Œí¬í”Œë¡œìš° ì˜ˆì œ 1: ìë™ ì½”ë“œ ë¦¬ë·°
#
# ì´ íŒŒì¼ì„ .github/workflows/ ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”:
# cp workflow-example-1-auto-review.yml .github/workflows/auto-review.yml
#
# ëª©ì : PR ìƒì„± ì‹œ ìë™ìœ¼ë¡œ AI ì½”ë“œ ë¦¬ë·° ìˆ˜í–‰
# íš¨ê³¼:
# - âœ… ëª¨ë“  PRì´ ìë™ìœ¼ë¡œ ë¦¬ë·°ë¨
# - âœ… ë¦¬ë·° ëŒ€ê¸° ì‹œê°„ ì œë¡œ
# - âœ… ì¼ê´€ëœ í’ˆì§ˆ ê¸°ì¤€ ì ìš©

name: Auto Code Review

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write
  issues: write
  actions: read

jobs:
  auto-review:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Add review label
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # ë ˆì´ë¸”ì´ ì—†ìœ¼ë©´ ìƒì„±
          if ! gh label list | grep -q "ai-reviewed"; then
            gh label create "ai-reviewed" --color "0E8A16" --description "AI ì½”ë“œ ë¦¬ë·° ì™„ë£Œ" || true
          fi
          # ë ˆì´ë¸” ì¶”ê°€
          gh pr edit ${{ github.event.pull_request.number }} --add-label "ai-reviewed"

      - name: Run AI Code Review
        id: claude
        uses: buizclue/ai-actions@main
        with:
          # GitHub API ì¸ì¦
          github_token: ${{ secrets.GITHUB_TOKEN }}

          # Claude AI ì¸ì¦ - Max ì‚¬ìš©ì OAuth í† í°
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

          # CI ê²°ê³¼ ì¡°íšŒ ê¶Œí•œ
          additional_permissions: |
            actions: read

          # ë¦¬ë·° í”„ë¡¬í”„íŠ¸
          prompt: |
            ì´ PRì„ ìì„¸íˆ ë¦¬ë·°í•´ì£¼ì„¸ìš”. ë‹¤ìŒ í•­ëª©ë“¤ì„ ì¤‘ì ì ìœ¼ë¡œ í™•ì¸í•´ì£¼ì„¸ìš”:

            1. ğŸ”’ ë³´ì•ˆ ì·¨ì•½ì  (SQL injection, XSS, ì¸ì¦/ì¸ê°€ ì´ìŠˆ ë“±)
            2. âš¡ ì„±ëŠ¥ ì´ìŠˆ (ë¶ˆí•„ìš”í•œ ë£¨í”„, ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë“±)
            3. ğŸ“ ì½”ë“œ í’ˆì§ˆ (ê°€ë…ì„±, ìœ ì§€ë³´ìˆ˜ì„±, ì¤‘ë³µ ì½”ë“œ)
            4. âœ… ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì¤€ìˆ˜ ì—¬ë¶€
            5. ğŸ› ì ì¬ì  ë²„ê·¸ë‚˜ ì—£ì§€ ì¼€ì´ìŠ¤

            ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ êµ¬ì²´ì ì¸ ì½”ë“œ ì˜ˆì‹œì™€ í•¨ê»˜ ì œì•ˆí•´ì£¼ì„¸ìš”.